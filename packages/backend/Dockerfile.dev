FROM node:18-alpine

ARG NODE_ENV
ARG BACKEND_URL
ARG BACKEND_PORT
ARG POSTGRES_USER
ARG POSTGRES_PASSWORD
ARG POSTGRES_DB

ENV NODE_ENV=$NODE_ENV
ENV BACKEND_URL=$BACKEND_URL
ENV BACKEND_PORT=$BACKEND_PORT
ENV POSTGRES_USER=$POSTGRES_USER
ENV POSTGRES_PASSWORD=$POSTGRES_PASSWORD
ENV POSTGRES_DB=$POSTGRES_DB

WORKDIR /usr/src/app

COPY package*.json ./
RUN test -d node_modules || yarn install

ENV PATH /usr/src/app/node_modules/.bin:$PATH

EXPOSE $BACKEND_PORT

CMD ["sh", "-c", "cross-env PORT=${BACKEND_PORT} nest start --watch"]